function checkSelectedSomeText(idOfElement) {
  element = document.getElementById(idOfElement);
  if (element != null) {
    if (element.value.length > 0) {
      return true;
    }
  }
  return false;
}

function checkSelectedSomeTextNotDashed(idOfElement) {
  element = document.getElementById(idOfElement);
  if (element != null) {
    if (element.value.length > 0 && element.value != '---') {
      return true;
    }
  }
  return false;
}

function enableIfElementsHaveSomeValueOld(resultName, el1name, el2name) {
  el1 = document.getElementById(el1name);
  el2 = document.getElementById(el2name);
  resultButton = document.getElementById(resultName);
  // by default it's disabled. It's enabled if certain special condition is met
  resultButton.disabled = true;
  if (el1 != null && el2 != null) {
    if (el1.value.length > 0 && el2.value.length > 0) {
      resultButton.disabled = false;
    }
  }
}


function haveElementWithValueOrUndefinedArg(elName) {
  if (elName == undefined) {
    return true;
  }
  el = document.getElementById(elName);
  if (el != null && el.value.length > 0) {
    return true;
  }
  return false;
}

function enableIfElementsHaveSomeValue(resultName, el1name, el2name, el3name) {
  resultButton = document.getElementById(resultName);
  // by default it's disabled. It's enabled if certain special condition is met
  resultButton.disabled = true;
  if (haveElementWithValueOrUndefinedArg(el1name) && haveElementWithValueOrUndefinedArg(el2name)
      && haveElementWithValueOrUndefinedArg(el3name)) {
    resultButton.disabled = false;
  }
}

function enableIfCountry1And2Selected() {
  enableIfElementsHaveSomeValue("compare", "country1", "country2");
}

function enableIfCity1And2Selected() {
  enableIfElementsHaveSomeValue("compare", "city1", "city2");
}

function startsWith(name, prefix) {
  if (name == undefined) {
    return false;
  }
  if (name.length < prefix.length) {
    return false;
  }
  return name.substr(0, prefix.length) == prefix;
}

function checkByName(nameprefix, visible)  {
  var allTags = document.getElementsByTagName('*');
  for (var i = 0; i < allTags.length; i++) {
    var tag =  allTags[i];
    var name = tag.name;
    if (name != undefined && startsWith(tag.name, nameprefix)) {
      allTags[i].checked = visible;
    }
  }
  return true;
}


function download_table_as_csv(table_id, separator = ';') {
    // Select rows from table_id
    var rows = document.querySelectorAll('table#' + table_id + ' tr');
    // Construct csv
    var csv = [];
    for (var i = 0; i < rows.length; i++) {
        var row = [], cols = rows[i].querySelectorAll('td, th');
        for (var j = 0; j < cols.length; j++) {
            // Clean innertext to remove multiple spaces and jumpline (break csv)
            var data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ')
            // Escape double-quote with double-double-quote (see https://stackoverflow.com/questions/17808511/properly-escape-a-double-quote-in-csv)
            data = data.replace(/"/g, '""');
            // Push escaped string
            row.push('"' + data + '"');
        }
        csv.push(row.join(separator));
  }
  var csv_string = csv.join('\n');

// Get the current URL
  var currentURL = window.location.href;
  var urlParts = currentURL.split('/');
  var lastPart = urlParts[urlParts.length - 1];
  var secondToLastPart = '';
  if (urlParts.length >= 2) {
  var secondToLastPart = urlParts[urlParts.length - 2];
  secondToLastPart = secondToLastPart.replace('.jsp', '');
  }
  var fileName = `${secondToLastPart}_${lastPart}`;
  var urlSearchParams = new URLSearchParams(window.location.search);
  var encodedParams = [...urlSearchParams.keys()].map(key => `${key}=${encodeURIComponent(urlSearchParams.get(key))}`).join('_');
  if (encodedParams.length > 0) {
    fileName += `_${encodedParams}`; 
  }
  fileName += '.csv';

  var link = document.createElement('a');
  link.style.display = 'none';
    link.setAttribute('target', '_blank');
    link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
    link.setAttribute('download', fileName);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}